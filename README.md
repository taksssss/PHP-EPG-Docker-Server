![php-epg](https://socialify.git.ci/TakcC/PHP-EPG-Docker-Server/image?description=1&descriptionEditable=Docker%F0%9F%90%B3%20%E9%83%A8%E7%BD%B2%EF%BC%8C%E5%B8%A6%E8%AE%BE%E7%BD%AE%E7%95%8C%E9%9D%A2%EF%BC%8C%E6%94%AF%E6%8C%81%20DIYP%20%26%20%E7%99%BE%E5%B7%9D%20%E3%80%81%20%E8%B6%85%E7%BA%A7%E7%9B%B4%E6%92%AD%20%E4%BB%A5%E5%8F%8A%20xmltv%20%E3%80%82&font=Inter&forks=1&issues=1&language=1&name=1&owner=1&pattern=Circuit%20Board&pulls=1&stargazers=1&theme=Auto)

# PHP-EPG-Docker-Server ğŸ“º
![Docker Pulls](https://img.shields.io/docker/pulls/taksss/php-epg) ![Image Size](https://img.shields.io/docker/image-size/taksss/php-epg
)

PHP å®ç°çš„ EPGï¼ˆç”µå­èŠ‚ç›®æŒ‡å—ï¼‰æœåŠ¡ç«¯ï¼Œ `Docker` éƒ¨ç½²ï¼Œè‡ªå¸¦è®¾ç½®ç•Œé¢ï¼Œæ”¯æŒ **`DIYP & ç™¾å·`** ã€ **`è¶…çº§ç›´æ’­`** ä»¥åŠ **`xmltv`** æ ¼å¼ã€‚

## ä¸»è¦åŠŸèƒ½ â„¹ï¸
- æ”¯æŒè¿”å› **`DIYP & ç™¾å·`** ã€ **`è¶…çº§ç›´æ’­`** ä»¥åŠ **`xmltv`** æ ¼å¼ ğŸ“¡
- æä¾› **`amd64`** è·Ÿ **`arm64`** æ¶æ„ `Docker` é•œåƒï¼Œæ”¯æŒç”µè§†ç›’å­ç­‰è®¾å¤‡ ğŸ³
- åŸºé•œåƒé‡‡ç”¨ `alpine-apache-php`ï¼Œ**å‹ç¼©åå¤§å°ä»… `20M`** ğŸ“¦
- é‡‡ç”¨**å…ˆæ„å»ºå†å­˜æ•°æ®åº“**çš„ç­–ç•¥ï¼Œå­˜åœ¨éƒ¨åˆ†å†—ä½™æ•°æ®ï¼Œä½†èƒ½**æé«˜è¯»å–é€Ÿåº¦** ğŸš€
- æ”¯æŒ**ç¹ä½“ä¸­æ–‡é¢‘é“åŒ¹é…** ğŸŒ
- æ”¯æŒ **å¤šå¯¹ä¸€é¢‘é“æ˜ å°„**ï¼Œæ”¯æŒ**æ­£åˆ™è¡¨è¾¾å¼** ğŸ”„
- æ”¯æŒè®¾ç½®**é¢‘é“å¿½ç•¥å­—ç¬¦è¡¨** ğŸ”‡
- æ”¯æŒç”Ÿæˆ**æŒ‡å®šé¢‘é“èŠ‚ç›®å•** ğŸ“
- å†…ç½®**å®šæ—¶ä»»åŠ¡**ï¼Œæ”¯æŒè®¾ç½®å®šæ—¶æ‹‰å–æ•°æ® â³
- å…¼å®¹å¤šç§ `xmltv` æ ¼å¼ ğŸ—‚ï¸
- ä½¿ç”¨ `SQLite` æ•°æ®åº“å­˜å‚¨ ğŸ—ƒï¸
- åŒ…å«ç½‘é¡µè®¾ç½®é¡µé¢ ğŸŒ
- æ”¯æŒå¤šä¸ª EPG æº ğŸ“¡
- å¯é…ç½®æ•°æ®ä¿å­˜å¤©æ•° ğŸ“…
- å†…ç½® `phpLiteAdmin` æ–¹ä¾¿ç®¡ç†æ•°æ®åº“ ğŸ› ï¸

![è®¾ç½®é¡µé¢](/pic/management.png)

> **å†…ç½®æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜ï¼š**
> 
> - ä»¥ `regex:` ä½œä¸ºå‰ç¼€
> 
> - ç¤ºä¾‹ï¼š
> 
>   - `regex:/^CCTV[-\s]*(\p{Han})/iu, $1` ï¼šå°† `CCTVé£äº‘è¶³çƒ`ã€`cctv-é£äº‘éŸ³ä¹` ç­‰æ›¿æ¢æˆ `é£äº‘è¶³çƒ`ã€`é£äº‘éŸ³ä¹`
> 
>   - `regex:/^CCTV[-\s]*(\d+(\s*P(LUS)?|[K\+])?)(?!ç¾æ´²|æ¬§æ´²).*/i => CCTV$1` ï¼šå°† `CCTV 1ç»¼åˆ`ã€`CCTV-4Ké¢‘é“`ã€`CCTV - 5+é¢‘é“`ã€`CCTV - 5PLUSé¢‘é“` ç­‰æ›¿æ¢æˆ `CCTV1`ã€`CCTV4K`ã€`CCTV5+`ã€`CCTV5PLUS`ï¼ˆæ’é™¤ `CCTV4ç¾æ´²` å’Œ `CCTV4æ¬§æ´²`ï¼‰
> 
>   - `regex:/^(æ·±åœ³.*?)é¢‘é“$/i, $1` ï¼šå°† `æ·±åœ³xxé¢‘é“` æ›¿æ¢æˆ `æ·±åœ³xx`

## æ›´æ–°æ—¥å¿— ğŸ“

### 2024-8-14æ›´æ–°ï¼š

1. ä¼˜åŒ–ï¼šé¢‘é“æ˜ å°„æ˜¾ç¤ºæ–¹å¼
2. æ–°å¢ï¼šåŒæ—¶ç”Ÿæˆ `.xml.gz` åŠ `.xml` é€‰é¡¹

### 2024-8-12æ›´æ–°ï¼š

1. æ–°å¢ï¼š`xmltv` æ–‡ä»¶æ ¼å¼é€‰é¡¹ï¼ˆ `.xml.gz` æˆ– `.xml`ï¼‰
2. ä¼˜åŒ–ï¼šé¢‘é“æ˜ å°„å¿½ç•¥ç©ºæ ¼ï¼ˆå¦‚ `CGTNè‹±è¯­ => CGTN` å¯å¯¹ `CGTN è‹±è¯­` è¿›è¡Œæ˜ å°„ï¼‰
3. ä¼˜åŒ–ï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¢åŠ  `CCTV 5P` é¢‘é“åŒ¹é…

### 2024-8-5æ›´æ–°ï¼š

1. ä¿®æ”¹éƒ¨åˆ† `opencc` åŠ `update.php` ä»£ç ï¼Œå…¼å®¹ `PHP 7.0` ä»¥ä¸Šç‰ˆæœ¬
2. æ–°å¢ `å…¥åº“å‰å¤„ç†é¢‘é“å` é€‰é¡¹ï¼ˆ `DIYP` è·Ÿ `è¶…çº§ç›´æ’­` ç”¨æˆ·ä¿æŒé»˜è®¤ `æ˜¯` å³å¯ï¼‰
3. æ›´æ–° `manage.php` ï¼Œæ‰“å¼€è®¾ç½®é¡µé¢æ—¶æ£€æŸ¥å®šæ—¶ä»»åŠ¡è¿è¡Œæƒ…å†µ
4. ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¢åŠ  `CCTV 5PLUS` é¢‘é“åŒ¹é…
5. æ–°å¢ `docker-compose.yml` ï¼Œå¯æŒä¹…åŒ– `adata.db` è·Ÿ `config.php` æ–‡ä»¶

- äº¦å¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œéœ€ç¡®ä¿ `å½“å‰ç›®å½•` åŒ…å«ä¸Šè¿°æ–‡ä»¶
  ```bash
  docker run -d \
   --name php-epg \
   -v ./adata.db:/htdocs/epg/adata.db \
   -v ./config.php:/htdocs/epg/config.php \
   -p 5678:80 \
   --restart always \
   taksss/php-epg:latest
  ```

### 2024-7-31æ›´æ–°ï¼š

1. éƒ¨åˆ†ç”¨æˆ·åé¦ˆ `phpLiteAdmin-ng` åœ¨ `php7.x` ä¸Šæ‰“å¼€è¾ƒæ…¢ï¼Œå·²æ¢å›ä¹‹å‰çš„ `phpLiteAdmin 1.9.71`
2. ä¿®å¤ `phpLiteAdmin 1.9.71` éƒ¨åˆ†èŠ‚ç›®ä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼š
   - å°†éƒ¨åˆ† `substr` ã€ `strlen` æ›¿æ¢ä¸º `mb_substr` ã€ `mb_strlen`
3. ä¿®å¤æœªè¿›å…¥â€œæ›´å¤šè®¾ç½®â€é¡µé¢ï¼Œ`Ctrl+S` ä¼šæ¸…ç©ºé™å®šé¢‘é“åˆ—è¡¨çš„é—®é¢˜

### 2024-7-30æ›´æ–°ï¼š

1. æ”¯æŒ**ç¹ä½“ä¸­æ–‡é¢‘é“åŒ¹é…**ï¼ˆæ„Ÿè°¢ [overtrue/php-opencc](https://github.com/overtrue/php-opencc) ï¼‰
2. æ”¯æŒç”Ÿæˆ**æŒ‡å®šé¢‘é“èŠ‚ç›®å•**ï¼ˆå¯é€šè¿‡ `.txt` æˆ– `.m3u` **èŠ‚ç›®æºå¯¼å…¥**ï¼‰
3. è°ƒæ•´é¡µé¢å¸ƒå±€ï¼Œå°†éƒ¨åˆ†è®¾ç½®æ”¾è‡³â€œ**æ›´å¤šè®¾ç½®**â€é¡µé¢ä¸­
4. ç”Ÿæˆ .xml.gz æ—¶ï¼Œé»˜è®¤åªåŒ…å«é¢„å‘Šæ•°æ®ï¼ˆå¯åœ¨è®¾ç½®ä¸­æ›´æ”¹ï¼‰
5. ä¿®æ”¹é¢‘é“å¿½ç•¥å­—ç¬¦ä¸²é€»è¾‘ï¼Œå°†å¿½ç•¥ç©ºæ ¼è®¾ä¸ºå¯é€‰ï¼ˆé»˜è®¤å¼€å¯ï¼‰
6. EPG åœ°å€åˆ—è¡¨æ”¯æŒ `Ctrl + /` è®¾ç½®ï¼ˆå–æ¶ˆï¼‰æ³¨é‡Š
7. é‡æ„éƒ¨åˆ†ä»£ç ï¼ŒåŠ å¿«æ•°æ®ç”Ÿæˆé€Ÿåº¦ï¼Œé™ä½å†…å­˜å ç”¨
8. æ”¹ç”¨ [phpLiteAdmin-ng](https://github.com/emanueleg/pla-ng/) ï¼Œä¿®å¤èŠ‚ç›®æ˜¾ç¤ºä¸å®Œå…¨çš„é—®é¢˜
9. ä¿®å¤é¢‘é“åŒ…å« `&` å­—ç¬¦ï¼ŒæŠ¥ `Warning` çš„é—®é¢˜
10. ä¿®å¤ cron.php é¦–æ¬¡æ‰§è¡Œåœ¨ç‰¹å®šæƒ…å†µä¸‹å¼‚å¸¸çš„é—®é¢˜

>
> åŠŸèƒ½åŸºæœ¬å®Œå–„ï¼Œæ²¡å¤§æ”¹åŠ¨çš„è¯ä¼šæ¯”è¾ƒå°‘æ›´æ–°äº†ã€‚
> 

### 2024-7-26æ›´æ–°ï¼š

1. è‡ªå®šä¹‰é¢‘é“åæ”¯æŒ**å¤šå¯¹ä¸€æ˜ å°„**
2. æ”¯æŒ**æ•´åˆ xmltv**ï¼Œå¹¶**ç”Ÿæˆ .xml.gz æ–‡ä»¶**ï¼Œé™ä½ç¡¬ç›˜å ç”¨
3. æ”¯æŒæŸ¥çœ‹ã€æœç´¢æ•°æ®åº“é¢‘é“åˆ—è¡¨ï¼Œæ–¹ä¾¿å¡«å†™æ˜ å°„
4. ä¿®å¤ cron.php åœ¨ç¬¬ä¸‰å¤©å¤±æ•ˆçš„é—®é¢˜
5. åˆ é™¤ epg_lovetv è¡¨ï¼Œè¶…çº§ç›´æ’­æ•°æ®ç›´æ¥ä»å¯¹åº” DIYP ä¸­ç”Ÿæˆï¼Œå‡å°‘æ•°æ®å†—ä½™
6. ä¼˜åŒ–æ›´æ–°å½“å¤©æ•°æ®çš„é€»è¾‘ï¼Œé¿å…æ›´æ–°æ—¶æ— æ³•è·å–èŠ‚ç›®è¡¨

### 2024-7-21æ›´æ–°ï¼š

1. **æ”¯æŒ `è¶…çº§ç›´æ’­` æ ¼å¼**
2. **é‡æ„ä»£ç ï¼ŒåŸºé•œåƒæ”¹ä¸º `alpine-apache-php` ï¼Œé•œåƒå¤§å°ä» 155M ä¸‹é™åˆ° 23M**
3. æ”¯æŒè§£æ M3U4U ç­‰é .xml/.gz ç»“å°¾ EPG åœ°å€
4. æ•°æ®åˆ†æ‰¹æ’å…¥ï¼Œé™ä½å†…å­˜å ç”¨
5. ä¿®å¤éƒ¨åˆ†ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸é—®é¢˜
6. ä¿®å¤è®¾ç½®é¡µé¢åˆ·æ–°ï¼Œæç¤ºâ€œæ˜¯å¦é‡æ–°æäº¤è¡¨å•â€é—®é¢˜
7. å¢åŠ æ¥å£æµ‹è¯•è¯´æ˜

### 2024-7-18æ›´æ–°ï¼š

1. æä¾› DockerğŸ³ é•œåƒï¼ˆåŸºäº php:7.4-apache ï¼Œæ”¯æŒ x86-64 è·Ÿ arm64 ï¼‰
2. æ”¯æŒå®šæ—¶æ›´æ–°æ•°æ®åº“
3. EPG æºæ”¯æŒæ·»åŠ æ³¨é‡Š
4. æ”¯æŒæ›´æ”¹ç™»å½•å¯†ç  ã€é»˜è®¤ä¸ºç©ºï¼ï¼ï¼ã€‘
5. æ”¯æŒæŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¥å¿—
6. æ”¯æŒæŸ¥çœ‹æ•°æ®åº“æ›´æ–°æ—¥å¿—
7. é…ç½®é¡µé¢æ”¯æŒ Ctrl+S ä¿å­˜
8. æ›´æ–°éƒ¨ç½²æµç¨‹

### 2024-7-14æ›´æ–°ï¼š

1. æ”¹ç”¨ Docker ComposeğŸ³ éƒ¨ç½²
2. æ›´æ–°éƒ¨ç½²æµç¨‹

### 2024-7-13æ›´æ–°ï¼š

1. ä¼˜åŒ–è‡ªå¸¦æ­£åˆ™è¡¨è¾¾å¼
2. æ›´æ–°é»˜è®¤è¿”å›æ•°æ®ï¼Œä¾›å›æ”¾ä½¿ç”¨
3. å¢åŠ  TiviMate ç¤ºä¾‹å›¾ç‰‡

### 2024-7-13åˆå§‹ç‰ˆæœ¬ï¼š

1. æ”¯æŒæ ‡å‡† xmltv å’Œ DIYP&ç™¾å· æ ¼å¼
2. åŒ…å«ç½‘é¡µè®¾ç½®é¡µé¢
3. æ”¯æŒå¤šä¸ª EPG æº
4. å¯é…ç½®æ•°æ®ä¿å­˜å¤©æ•°
5. æ”¯æŒè®¾ç½®é¢‘é“å¿½ç•¥å­—ç¬¦ä¸²
6. æ”¯æŒé¢‘é“æ˜ å°„ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
7. å†…ç½® phpLiteAdmin æ–¹ä¾¿ç®¡ç†æ•°æ®åº“

## TODOï¼š

- [x] æ”¯æŒè¿”å›è¶…çº§ç›´æ’­æ ¼å¼
- [x] æ•´åˆæ›´è½»é‡çš„ alpine-apache-php å®¹å™¨
- [x] æ•´åˆç”Ÿæˆ xml æ–‡ä»¶
- [x] æ”¯æŒå¤šå¯¹ä¸€é¢‘é“æ˜ å°„
- [x] æ”¯æŒç¹ä½“é¢‘é“åŒ¹é…
- [x] ä»…ä¿å­˜æŒ‡å®šé¢‘é“åˆ—è¡¨èŠ‚ç›®å•

## éƒ¨ç½²æ­¥éª¤ ğŸš€

1. é…ç½® `Docker` ç¯å¢ƒ

2. è‹¥å·²å®‰è£…è¿‡ï¼Œå…ˆåˆ é™¤æ—§ç‰ˆæœ¬ï¼ˆæ³¨æ„å¤‡ä»½æ•°æ®ï¼‰

   ```bash
   docker rm php-epg -f
   ```

3. æ‹‰å–é•œåƒå¹¶è¿è¡Œï¼š

   ```bash
   docker run -d \
     --name php-epg \
     -p 5678:80 \
     --restart always \
     taksss/php-epg:latest
   ```

   >
   > é»˜è®¤ç«¯å£ä¸º `5678` ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚
   > 

- `adata.db` è·Ÿ `config.php` æ–‡ä»¶æŒä¹…åŒ–ï¼š
  - ä¸‹è½½ `æºä»£ç ` åï¼Œåœ¨ `é¡¹ç›®æ ¹ç›®å½•` æ‰§è¡Œ `docker-compose up -d` éƒ¨ç½²ï¼ˆåç»­å‡çº§æ— éœ€é‡æ–°ä¸‹è½½æºä»£ç ï¼‰
  - æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ ï¼Œéœ€ç¡®ä¿ `å½“å‰ç›®å½•` å­˜åœ¨ `adata.db` åŠ `config.php` æ–‡ä»¶
    ```bash
    docker run -d \
      --name php-epg \
      -v ./adata.db:/htdocs/epg/adata.db \
      -v ./config.php:/htdocs/epg/config.php \
      -p 5678:80 \
      --restart always \
      taksss/php-epg:latest
     ```


## ä½¿ç”¨æ­¥éª¤ ğŸ› ï¸

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/manage.php`

2. **é»˜è®¤å¯†ç ä¸ºç©º**ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œè®¾ç½®

3. æ·»åŠ  `EPG æºåœ°å€`ï¼Œ GitHub æºç¡®ä¿èƒ½å¤Ÿè®¿é—®ï¼Œç‚¹å‡» `æ›´æ–°é…ç½®` ä¿å­˜

4. ç‚¹å‡» `æ›´æ–°æ•°æ®åº“` æ‹‰å–æ•°æ®ï¼Œç‚¹å‡» `æ•°æ®åº“æ›´æ–°æ—¥å¿—` æŸ¥çœ‹æ—¥å¿—ï¼Œç‚¹å‡» `æŸ¥çœ‹æ•°æ®åº“` æŸ¥çœ‹å…·ä½“æ¡ç›®

5. è®¾ç½® `å®šæ—¶ä»»åŠ¡` ï¼Œç‚¹å‡» `æ›´æ–°é…ç½®` ä¿å­˜ï¼Œç‚¹å‡» `å®šæ—¶ä»»åŠ¡æ—¥å¿—` æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¶é—´è¡¨

6. ç‚¹å‡» `æ›´å¤šè®¾ç½®` ï¼Œé€‰æ‹©æ˜¯å¦ `ç”Ÿæˆxmlæ–‡ä»¶` ã€`ç”Ÿæˆæ–¹å¼` ï¼Œè®¾ç½® `é™å®šé¢‘é“èŠ‚ç›®å•`

7. ç”¨æµè§ˆå™¨æµ‹è¯•å„ä¸ªæ¥å£çš„è¿”å›ç»“æœæ˜¯å¦æ­£ç¡®ï¼š

    - `xmltv` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php`
    
    - `DIYP&ç™¾å·` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php?ch=CCTV1`
    
    - `è¶…çº§ç›´æ’­` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php?channel=CCTV1`

8. å°† **`http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php`** å¡«å…¥ `DIYP`ã€`TiviMate` ç­‰è½¯ä»¶çš„ `EPG åœ°å€æ `

    - âš ï¸ ç›´æ¥ä½¿ç”¨ `docker run` è¿è¡Œçš„è¯ï¼Œå¯ä»¥å°† `:5678/epg/index.php` æ›¿æ¢ä¸º `:5678/epg`ã€‚
    - âš ï¸ éƒ¨åˆ†è½¯ä»¶ä¸æ”¯æŒè·³è½¬è§£æ `xmltv` æ–‡ä»¶ï¼Œå¯ç›´æ¥ä½¿ç”¨ **`:5678/epg/t.xml.gz`** æˆ– **`:5678/epg/t.xml`** è®¿é—®ã€‚

>
> **å¿«æ·é”®ï¼š**
>
> - `Ctrl + S`ï¼šä¿å­˜è®¾ç½®
> 
> - `Ctrl + /`ï¼šå¯¹é€‰ä¸­ EPG åœ°å€è®¾ç½®ï¼ˆå–æ¶ˆï¼‰æ³¨é‡Š
> 

**è®¾ç½®å®šæ—¶ä»»åŠ¡**

![è®¾ç½®å®šæ—¶ä»»åŠ¡](/pic/cronSet.png)

**å®šæ—¶ä»»åŠ¡æ—¥å¿—**

![å®šæ—¶ä»»åŠ¡æ—¥å¿—](/pic/cronLog.png)

**æ›´æ–°æ—¥å¿—**

![æ›´æ–°æ—¥å¿—](/pic/updateLog.png)

**æŸ¥çœ‹ã€æœç´¢é¢‘é“**

![æŸ¥çœ‹é¢‘é“åˆ—è¡¨](/pic/channels.png)

**æ›´å¤šè®¾ç½®**

![æ›´å¤šè®¾ç½®](/pic/moresetting.png)

**phpLiteAdmin**

![phpLiteAdmin](/pic/phpliteadmin.png)

## æ•ˆæœç¤ºä¾‹ ğŸ–¼ï¸

**DIYP**

![DIYP ç¤ºä¾‹](/pic/DIYP.png)

**TiviMate**

![TiviMate](/pic/TiviMate.jpg)


## ç‰¹åˆ«é¸£è°¢ ğŸ™
- [ChatGPT](https://chatgpt.com/)
- [celetor/epg](https://github.com/celetor/epg)
- [sparkssssssssss/epg](https://github.com/sparkssssssssss/epg)
- [Black_crow/xmlgz](https://gitee.com/Black_crow/xmlgz)
- [DIYP](https://diyp.112114.xyz/)
- [EPG 51zmt](http://epg.51zmt.top:8000/)
