![php-epg](https://socialify.git.ci/TakcC/PHP-EPG-Docker-Server/image?description=1&descriptionEditable=Docker%F0%9F%90%B3%20%E9%83%A8%E7%BD%B2%EF%BC%8C%E5%B8%A6%E8%AE%BE%E7%BD%AE%E7%95%8C%E9%9D%A2%EF%BC%8C%E6%94%AF%E6%8C%81%20DIYP%20%26%20%E7%99%BE%E5%B7%9D%20%E3%80%81%20%E8%B6%85%E7%BA%A7%E7%9B%B4%E6%92%AD%20%E4%BB%A5%E5%8F%8A%20xmltv%20%E3%80%82&font=Inter&forks=1&issues=1&language=1&name=1&owner=1&pattern=Circuit%20Board&pulls=1&stargazers=1&theme=Auto)

# PHP-EPG-Docker-Server ğŸ“º
![Docker Pulls](https://img.shields.io/docker/pulls/taksss/php-epg) ![Image Size](https://img.shields.io/docker/image-size/taksss/php-epg
)

PHP å®ç°çš„ EPGï¼ˆç”µå­èŠ‚ç›®æŒ‡å—ï¼‰æœåŠ¡ç«¯ï¼Œ `Docker` éƒ¨ç½²ï¼Œè‡ªå¸¦è®¾ç½®ç•Œé¢ï¼Œæ”¯æŒ **`DIYP & ç™¾å·`** ã€ **`è¶…çº§ç›´æ’­`** ä»¥åŠ **`xmltv`** æ ¼å¼ã€‚

## ä¸»è¦åŠŸèƒ½ â„¹ï¸
- æ”¯æŒè¿”å› **`DIYP & ç™¾å·`** ã€ **`è¶…çº§ç›´æ’­`** ä»¥åŠ **`xmltv`** æ ¼å¼ ğŸ“¡
- ä¸€é”®ç”ŸæˆåŒ¹é… `M3U` çš„ `xmltv` æ ¼å¼ `EPG` æ–‡ä»¶ ğŸ’¯
- æä¾› **`amd64`** è·Ÿ **`arm64`** æ¶æ„ `Docker` é•œåƒï¼Œæ”¯æŒ**ç”µè§†ç›’å­**ç­‰è®¾å¤‡ ğŸ³
- åŸºé•œåƒé‡‡ç”¨ `alpine-apache-php`ï¼Œ**å‹ç¼©åå¤§å°ä»… `20M`** ğŸ“¦
- é‡‡ç”¨**å…ˆæ„å»ºå†å­˜æ•°æ®åº“**çš„ç­–ç•¥ï¼Œ**æé«˜è¯»å–é€Ÿåº¦** ğŸš€
- æ”¯æŒ**ç¹ä½“ä¸­æ–‡é¢‘é“åŒ¹é…** ğŸŒ
- æ”¯æŒ**å¤šå¯¹ä¸€é¢‘é“æ˜ å°„**ï¼Œæ”¯æŒ**æ­£åˆ™è¡¨è¾¾å¼** ğŸ”„
- æ”¯æŒè®¾ç½®**é¢‘é“å¿½ç•¥å­—ç¬¦è¡¨** ğŸ”‡
- æ”¯æŒç”Ÿæˆ**æŒ‡å®šé¢‘é“èŠ‚ç›®å•** ğŸ“
- å†…ç½®**å®šæ—¶ä»»åŠ¡**ï¼Œæ”¯æŒè®¾ç½®å®šæ—¶æ‹‰å–æ•°æ® â³
- å…¼å®¹å¤šç§ `xmltv` æ ¼å¼ ğŸ—‚ï¸
- ä½¿ç”¨ `SQLite` æ•°æ®åº“å­˜å‚¨ ğŸ—ƒï¸
- åŒ…å«ç½‘é¡µè®¾ç½®é¡µé¢ ğŸŒ
- æ”¯æŒå¤šä¸ª EPG æº ğŸ“¡
- å¯é…ç½®æ•°æ®ä¿å­˜å¤©æ•° ğŸ“…
- å†…ç½® `phpLiteAdmin` æ–¹ä¾¿ç®¡ç†æ•°æ®åº“ ğŸ› ï¸

![è®¾ç½®é¡µé¢](/pic/management.png)

> **å†…ç½®æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜ï¼š**
> - ä»¥ `regex:` ä½œä¸ºå‰ç¼€
> - ç¤ºä¾‹ï¼š
>   - `regex:/^CCTV[-\s]*(\p{Han})/iu, $1` ï¼šå°† `CCTVé£äº‘è¶³çƒ`ã€`cctv-é£äº‘éŸ³ä¹` ç­‰æ›¿æ¢æˆ `é£äº‘è¶³çƒ`ã€`é£äº‘éŸ³ä¹`
>   - `regex:/^CCTV[-\s]*(\d+(\s*P(LUS)?|[K\+])?)(?!ç¾æ´²|æ¬§æ´²).*/i => CCTV$1` ï¼šå°† `CCTV 1ç»¼åˆ`ã€`CCTV-4Ké¢‘é“`ã€`CCTV - 5+é¢‘é“`ã€`CCTV - 5PLUSé¢‘é“` ç­‰æ›¿æ¢æˆ `CCTV1`ã€`CCTV4K`ã€`CCTV5+`ã€`CCTV5PLUS`ï¼ˆæ’é™¤ `CCTV4ç¾æ´²` å’Œ `CCTV4æ¬§æ´²`ï¼‰
>   - `regex:/^(æ·±åœ³.*?)é¢‘é“$/i, $1` ï¼šå°† `æ·±åœ³xxé¢‘é“` æ›¿æ¢æˆ `æ·±åœ³xx`

## æ›´æ–°æ—¥å¿— ğŸ“

### 2024-8-24æ›´æ–°ï¼š

1. æ–°å¢ï¼šæ”¹ç”¨ `XMLWriter` ç”Ÿæˆ `xmltv` æ–‡ä»¶ï¼ŒåŠ å¿«ç”Ÿæˆé€Ÿåº¦ï¼Œé™ä½å†…å­˜å ç”¨ï¼ˆç”Ÿæˆå…¨é‡æ•°æ®ï¼Œ`100M` ä»¥å†…å³å¯ï¼‰
2. æ–°å¢ï¼šâ€œé™å®šé¢‘é“åˆ—è¡¨â€å¯ç›´æ¥ä» `M3U` ã€ `TXT` åœ°å€è·å–
3. æ–°å¢ï¼šè®¾ç½®â€œé™å®šé¢‘é“åˆ—è¡¨â€åï¼Œç”Ÿæˆ `xmltv` çš„é¢‘é“åä»¥åˆ—è¡¨çš„ä¸ºå‡†ï¼ˆå¯ç”ŸæˆåŒ¹é… `M3U` çš„ `EPG` æ–‡ä»¶ï¼‰
4. æ–°å¢ï¼š`NewTV`ã€`SiTV`ã€`iHOT`ã€`CHC` ç³»åˆ—é¢‘é“æ˜ å°„è§„åˆ™
5. ä¼˜åŒ–ï¼šå°†æ•°æ®æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ° `data` æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿è¿›è¡Œ[æ•°æ®æŒä¹…åŒ–](#æ•°æ®æŒä¹…åŒ–)ï¼ˆâš ï¸æ³¨æ„æ›´æ–°ï¼‰
6. ä¼˜åŒ–ï¼šèŠ‚ç›®åŒ¹é…æ—¶ï¼Œä¼˜å…ˆé‡‡ç”¨ç²¾ç¡®åŒ¹é…ç»“æœ
7. ä¼˜åŒ–ï¼šéƒ¨åˆ† `EPG` æ¡ç›®è·¨å¤©æ—¶ï¼Œç”Ÿæˆ 2 æ¡æ•°æ®
8. ä¼˜åŒ–ï¼š`desc` å­—æ®µçš„ç”Ÿæˆé€»è¾‘
9. ä¼˜åŒ–ï¼šåˆ é™¤éƒ¨åˆ†å†—ä½™é€‰é¡¹

> âš ï¸è¯¥ç‰ˆæœ¬æ”¹åŠ¨è¾ƒå¤šï¼Œå»ºè®®ç›´æ¥æ›´æ–°

### 2024-8-21æ›´æ–°ï¼š

1. æ–°å¢ï¼šé€€å‡ºæŒ‰é’®ï¼ˆæ„Ÿè°¢[mxdabc](https://github.com/mxdabc/epgphp)ï¼‰
2. ä¿®å¤ï¼šè¯­æ³•é”™è¯¯ï¼ˆæ„Ÿè°¢[mxdabc](https://github.com/mxdabc/epgphp)ï¼‰
3. æ–°å¢ï¼šä½¿ç”¨ `GitHub Actions` ç”Ÿæˆã€æ¨é€é•œåƒåˆ° `DockerHub` åŠ `è…¾è®¯äº‘å®¹å™¨é•œåƒç«™`
4. ä¿®å¤ï¼šç‚¹å‡»é€€å‡ºæŒ‰é’®åå†æ¬¡ç™»å½•ï¼Œæ— æ³•æŸ¥çœ‹æ—¥å¿—

### 2024-8-20æ›´æ–°ï¼š

1. æ–°å¢ï¼šåŒæ­¥æä¾› `è…¾è®¯äº‘å®¹å™¨é•œåƒ` ï¼Œæ— æ³•æ­£å¸¸æ‹‰å–é•œåƒçš„ç”¨æˆ·å¯ä½¿ç”¨
2. æ–°å¢ï¼šé»˜è®¤è¿”å›â€œç²¾å½©èŠ‚ç›®â€é€‰é¡¹
3. æ–°å¢ï¼šæ›´æ–°å‰æ£€æŸ¥ EPG æ–‡ä»¶ï¼Œæ— å˜åŒ–åˆ™è·³è¿‡
4. ä¼˜åŒ–ï¼šåˆ†æ‰¹æ’å…¥æ•°æ®ï¼Œé™ä½å†…å­˜å ç”¨
5. ä¼˜åŒ–ï¼šé…ç½®æ–‡ä»¶ä» `config.php` æ”¹ä¸º `config.json`
6. ä¿®å¤ï¼šé¢‘é“æ˜ å°„æ¯æ¬¡åªèƒ½æ›´æ–°ä¸€æ¡çš„é—®é¢˜

### å…¶ä»–è§[æ›´æ–°æ—¥å¿—](./CHANGELOG.md)

## TODOï¼š

- [x] æ”¯æŒè¿”å›è¶…çº§ç›´æ’­æ ¼å¼
- [x] æ•´åˆæ›´è½»é‡çš„ alpine-apache-php å®¹å™¨
- [x] æ•´åˆç”Ÿæˆ xml æ–‡ä»¶
- [x] æ”¯æŒå¤šå¯¹ä¸€é¢‘é“æ˜ å°„
- [x] æ”¯æŒç¹ä½“é¢‘é“åŒ¹é…
- [x] ä»…ä¿å­˜æŒ‡å®šé¢‘é“åˆ—è¡¨èŠ‚ç›®å•

## éƒ¨ç½²æ­¥éª¤ ğŸš€

1. é…ç½® `Docker` ç¯å¢ƒ

2. è‹¥å·²å®‰è£…è¿‡ï¼Œå…ˆåˆ é™¤æ—§ç‰ˆæœ¬ï¼ˆæ³¨æ„å¤‡ä»½æ•°æ®ï¼‰

   ```bash
   docker rm php-epg -f
   ```

3. æ‹‰å–é•œåƒå¹¶è¿è¡Œï¼š

   ```bash
   docker run -d \
     --name php-epg \
     -p 5678:80 \
     --restart always \
     taksss/php-epg:latest
   ```

   > é»˜è®¤ç«¯å£ä¸º `5678` ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚
   > æ— æ³•æ­£å¸¸æ‹‰å–é•œåƒçš„ï¼Œå¯ä½¿ç”¨åŒæ­¥æ›´æ–°çš„ `è…¾è®¯äº‘å®¹å™¨é•œåƒ`ï¼ˆ`ccr.ccs.tencentyun.com/taksss/php-epg:latest`ï¼‰

### æ•°æ®æŒä¹…åŒ–
- ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œ`./data` å¯æ ¹æ®è‡ªå·±éœ€è¦æ›´æ”¹
    ```bash
    docker run -d \
      --name php-epg \
      -v ./data:/htdocs/epg/data \
      -p 5678:80 \
      --restart always \
      taksss/php-epg:latest
     ```

- æ–°å»º [`docker-compose.yml`](./docker-compose.yml) æ–‡ä»¶åï¼Œåœ¨åŒç›®å½•æ‰§è¡Œ `docker-compose up -d`

## ä½¿ç”¨æ­¥éª¤ ğŸ› ï¸

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/manage.php`
2. **é»˜è®¤å¯†ç ä¸ºç©º**ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œè®¾ç½®
3. æ·»åŠ  `EPG æºåœ°å€`ï¼Œ GitHub æºç¡®ä¿èƒ½å¤Ÿè®¿é—®ï¼Œç‚¹å‡» `æ›´æ–°é…ç½®` ä¿å­˜
4. ç‚¹å‡» `æ›´æ–°æ•°æ®åº“` æ‹‰å–æ•°æ®ï¼Œç‚¹å‡» `æ•°æ®åº“æ›´æ–°æ—¥å¿—` æŸ¥çœ‹æ—¥å¿—ï¼Œç‚¹å‡» `æŸ¥çœ‹æ•°æ®åº“` æŸ¥çœ‹å…·ä½“æ¡ç›®
5. è®¾ç½® `å®šæ—¶ä»»åŠ¡` ï¼Œç‚¹å‡» `æ›´æ–°é…ç½®` ä¿å­˜ï¼Œç‚¹å‡» `å®šæ—¶ä»»åŠ¡æ—¥å¿—` æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¶é—´è¡¨

    > å»ºè®®ä» `å‡Œæ™¨1ç‚¹` å·¦å³å¼€å§‹æŠ“ï¼Œå¾ˆå¤šæº `00:00 ~ 00:30` éƒ½æ˜¯æ— æ•°æ®ã€‚
    > éš” `6 ~ 12` å°æ—¶æŠ“ä¸€æ¬¡å³å¯ã€‚

6. ç‚¹å‡» `æ›´å¤šè®¾ç½®` ï¼Œé€‰æ‹©æ˜¯å¦ `ç”Ÿæˆxmlæ–‡ä»¶` ã€`ç”Ÿæˆæ–¹å¼` ï¼Œè®¾ç½® `é™å®šé¢‘é“èŠ‚ç›®å•`
7. ç”¨æµè§ˆå™¨æµ‹è¯•å„ä¸ªæ¥å£çš„è¿”å›ç»“æœæ˜¯å¦æ­£ç¡®ï¼š
    - `xmltv` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php`
    - `DIYP&ç™¾å·` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php?ch=CCTV1`
    - `è¶…çº§ç›´æ’­` æ¥å£ï¼š `http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php?channel=CCTV1`
8. å°† **`http://{æœåŠ¡å™¨IPåœ°å€}:5678/epg/index.php`** å¡«å…¥ `DIYP`ã€`TiviMate` ç­‰è½¯ä»¶çš„ `EPG åœ°å€æ `
    - âš ï¸ ç›´æ¥ä½¿ç”¨ `docker run` è¿è¡Œçš„è¯ï¼Œå¯ä»¥å°† `:5678/epg/index.php` æ›¿æ¢ä¸º **`:5678/epg`**ã€‚
    - âš ï¸ éƒ¨åˆ†è½¯ä»¶ä¸æ”¯æŒè·³è½¬è§£æ `xmltv` æ–‡ä»¶ï¼Œå¯ç›´æ¥ä½¿ç”¨ **`:5678/epg/t.xml.gz`** æˆ– **`:5678/epg/t.xml`** è®¿é—®ã€‚

> **å¿«æ·é”®ï¼š**
> - `Ctrl + S`ï¼šä¿å­˜è®¾ç½®
> - `Ctrl + /`ï¼šå¯¹é€‰ä¸­ EPG åœ°å€è®¾ç½®ï¼ˆå–æ¶ˆï¼‰æ³¨é‡Š

**è®¾ç½®å®šæ—¶ä»»åŠ¡**

![è®¾ç½®å®šæ—¶ä»»åŠ¡](/pic/cronSet.png)

**å®šæ—¶ä»»åŠ¡æ—¥å¿—**

![å®šæ—¶ä»»åŠ¡æ—¥å¿—](/pic/cronLog.png)

**æ›´æ–°æ—¥å¿—**

![æ›´æ–°æ—¥å¿—](/pic/updateLog.png)

**æŸ¥çœ‹ã€æœç´¢é¢‘é“**

![æŸ¥çœ‹é¢‘é“åˆ—è¡¨](/pic/channels.png)

**æ›´å¤šè®¾ç½®**

![æ›´å¤šè®¾ç½®](/pic/moresetting.png)

**phpLiteAdmin**

![phpLiteAdmin](/pic/phpliteadmin.png)

## æ•ˆæœç¤ºä¾‹ ğŸ–¼ï¸

**DIYP**

![DIYP ç¤ºä¾‹](/pic/DIYP.png)

**TiviMate**

![TiviMate](/pic/TiviMate.jpg)


## ç‰¹åˆ«é¸£è°¢ ğŸ™
- [ChatGPT](https://chatgpt.com/)
- [celetor/epg](https://github.com/celetor/epg)
- [sparkssssssssss/epg](https://github.com/sparkssssssssss/epg)
- [Black_crow/xmlgz](https://gitee.com/Black_crow/xmlgz)
- [DIYP](https://diyp.112114.xyz/)
- [EPG 51zmt](http://epg.51zmt.top:8000/)
